# Module Specification

**Path:** data/raw
**Generated by:** Codex cleanup task
**Date:** 2025-10-31

Specification: Raw Data Layer

Module Path: data/raw/
Parent Specs:

data/spec.md (data layer overview)

core/meta/spec.md (chronicle and provenance integration)

trainer/spec.md (data preprocessing interface)

I. Mission

The Raw Data Layer serves as the immutable ground truth repository for all medical imaging inputs.
It preserves original image fidelity, acquisition metadata, and diagnostic annotations in a transparent, auditable format â€” forming the baseline for every subsequent computation in the Cognitive Research Hub.

Core design goals:

ğŸ”’ Integrity: Data is immutable after ingestion.

ğŸ“œ Traceability: Each file has a permanent manifest record and checksum.

ğŸ§¬ Compliance: Adheres to medical privacy and anonymization standards.

âš–ï¸ Reproducibility: All downstream tensors, spectra, and features derive deterministically from this layer.

II. Directory Layout
data/raw/
â”œâ”€ DICOM/               # Primary medical image storage (MRI, CT, XRAY, etc.)
â”‚  â”œâ”€ MRI/
â”‚  â”œâ”€ CT/
â”‚  â”œâ”€ XRAY/
â”‚  â”œâ”€ Ultrasound/
â”‚  â””â”€ PET/
â”œâ”€ annotations/         # Ground-truth segmentation and diagnostic notes
â”‚  â”œâ”€ json/             # Polygon or mask coordinates
â”‚  â”œâ”€ masks/            # Image-space binary or multi-class masks
â”‚  â””â”€ reports/          # Textual radiology notes or clinical findings
â”œâ”€ metadata/            # Study-level acquisition and demographic info
â”‚  â”œâ”€ equipment/
â”‚  â”œâ”€ parameters/
â”‚  â””â”€ institutions/
â”œâ”€ manifests/           # Immutable JSON index of every file and its checksum
â””â”€ logs/                # Integrity and schema validation results

III. File Format Standards
Type	Format	Purpose
Image	DICOM (.dcm) or NIfTI (.nii)	Raw image data, 16-bit or 32-bit float intensity
Annotation	JSON or PNG Mask	Manual or automated labels, segmentation masks
Metadata	JSON or CSV	Device parameters, acquisition protocol, subject details
Manifest	JSON	Provenance, checksums, file lineage
Logs	JSON or TXT	Audit and validation outcomes

All DICOMs are stored in their original byte order and compression, unless explicitly converted under a verified manifest entry.

IV. Manifest & Provenance Schema

Each import batch generates a manifest stored at data/raw/manifests/manifest_<YYYYMMDD>.json.

Example:

{
  "manifest_id": "2025-10-31T18:45:00Z",
  "batch_origin": "MRI_Retinal_Study_02",
  "entries": [
    {
      "uid": "MRI_000134",
      "file_path": "data/raw/DICOM/MRI/MRI_000134.dcm",
      "checksum_crc64": "3aef95b2d96a117c",
      "acquisition_date": "2025-09-15T14:20:00Z",
      "anonymized": true,
      "annotation_path": "data/raw/annotations/masks/MRI_000134_mask.png",
      "metadata_path": "data/raw/metadata/equipment/MRI_unit3.json"
    }
  ],
  "total_files": 512,
  "schema_version": "1.0",
  "verified": true
}


Each manifest is cross-validated by core/meta/chronicle.rs for:

Checksum consistency

File count agreement

Timestamp ordering

Schema conformance

V. Deterministic Ingestion Workflow

All data entering data/raw/ passes through the Ingestion Agent, which enforces:

Step	Operation	Description
1	Intake	Copy files into /DICOM preserving hierarchy
2	Hashing	Compute CRC-64 checksum
3	Metadata extraction	Parse DICOM headers (PatientID, SeriesUID, StudyUID)
4	Anonymization	Replace all patient identifiers with hash-based surrogates
5	Manifest write	Create manifest entry linking image, annotation, metadata
6	Validation	Confirm byte integrity and manifest schema correctness

No file is accepted without a matching checksum and metadata reference.

VI. Deterministic Constraints

To guarantee reproducibility and compliance across OS and hardware:

Immutability: No file modification after ingestion.

Checksum: CRC-64 (ISO variant) required for all entries.

Naming convention:

<modality>_<seriesUID>_<instanceUID>.dcm


Metadata lock: JSON entries cannot be updated post-ingest â€” new metadata requires a new manifest version.

Cross-platform byte parity: Verified via periodic Linux/Windows comparison job.

VII. Validation Pipeline

All raw data is validated automatically using core/diagnostics/metrics.rs.

Check	Description	Criteria
Checksum Match	File hash = Manifest record	âœ… Required
Header Schema	Valid DICOM or NIfTI tags	âœ… Required
Anonymization	No PHI fields remaining	âœ… Required
Resolution Range	64Ã—64â€“2048Ã—2048	Within limits
Pixel Intensity Drift	vs previous manifest	â‰¤ 1% allowed
Manifest Integrity	JSON schema valid	âœ… Required

Reports are stored in data/raw/logs/validation_<timestamp>.json.

VIII. Anonymization Policy

The anonymization system follows DICOM PS 3.15 (2023c) compliant workflow:

All PatientName, PatientID, and AccessionNumber replaced by cryptographic hash (SHA-256 truncated to 12 chars).

Dates offset by random seed (deterministic per study).

Pixel data containing burned-in annotations masked via threshold + OCR verification.

All replacement operations logged with reversible key in secure offline vault.

IX. Inter-Module Dependencies
Module	Reads	Writes	Purpose
trainer/preprocessing	raw/DICOM	processed/	Generates ChromaticTensors
core/meta	raw/manifests	experiments/results	Embeds provenance
core/diagnostics	raw/logs	data/raw/logs	Runs validation
scripts/data_sync	raw/DICOM	remote storage	Backup and replication
X. Ethical and Legal Compliance
Regulation	Compliance Mechanism
HIPAA (US)	De-identification + PHI scrub
GDPR (EU)	Consent log + data minimization
ISO 13485	Quality management process integration
FDA CFR 21 Part 11	Audit trail preservation (meta/chronicle)
XI. Retention and Lifecycle
Category	Retention	Notes
DICOM / NIfTI	Permanent	Immutable
Annotations	Permanent	Versioned
Metadata	Permanent	Versioned
Manifests	Permanent	Immutable
Logs	12 months	Archived to /experiments/archive/
XII. Compliance Summary
Field	Specification
Spec Version	1.0
Determinism Level	Full (bit-for-bit)
Checksum	CRC-64/ISO
PHI Compliance	Verified
Audit Authority	Meta Chronicle Agent (Codex)
Revision	{{auto-date}}
Status	âœ… Certified Immutable