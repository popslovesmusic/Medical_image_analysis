# Module Specification

**Path:** data
**Generated by:** Codex cleanup task
**Date:** 2025-10-31


Specification: Data Layer

Module Path: data/
Parent References:

cognitive-research-hub/spec.md (global governance)

trainer/spec.md (data ingestion & pipeline interface)

Root AGENTS.md (integrity and ethical handling policies)

I. Mission

The Data Layer provides the single, deterministic source of truth for all image, tensor, and derived metadata used by the Cognitive Research Hub.
It ensures reproducibility, immutability of source data, and safe transformation through well-defined staging directories.

All input and processed data must be:

Traceable: each file linked to a manifest entry with checksum and provenance.

Deterministic: all transformations performed with fixed random seeds and logged.

Ethical: compliant with de-identification and privacy guarantees per AGENTS.md.

II. Directory Layout
data/
├─ raw/                 # Original, immutable medical imaging data
│  ├─ DICOM/            # Source modality folders (MRI, CT, Ultrasound, etc.)
│  ├─ annotations/      # Radiologist or automated labels
│  └─ metadata/         # Acquisition parameters, device info
├─ processed/           # Preprocessed and normalized data ready for models
│  ├─ tensors/          # ChromaticTensor / SpectralTensor serialized sets
│  ├─ slices/           # Resampled or windowed 2D/3D images
│  ├─ masks/            # Segmentation and region of interest masks
│  └─ manifests/        # JSON manifests linking all processed assets
├─ samples/             # Lightweight subsets for testing and demos
│  ├─ public_examples/
│  ├─ synthetic/        # AI-generated or anonymized examples
│  └─ readme.md
└─ logs/                # Data validation and audit results

III. Data Flow Stages
Stage	Input	Output	Responsible Module
Acquisition	Raw DICOM, annotations	Manifest + metadata JSON	data/raw/
Preprocessing	Raw + configs	Normalized slices, tensors	**trainer/src/tokenizer/**
Transformation	Processed tensors	Chromatic/Spectral tensors	core/src/tensor/
Validation	Any stage	Audit logs	core/src/diagnostics/

All transitions must emit a record into processed/manifests/manifest_<timestamp>.json.

IV. File Naming Convention
<modality>_<patientID>_<seriesID>_<timestamp>.<ext>


Modality: MRI, CT, XR, US, etc.

PatientID: anonymized integer or hash.

Timestamp: UTC ISO format YYYYMMDD_HHMMSS.

Ext: .dcm, .nii, .npy, .cten, .sten, .json.

V. Manifest Schema

Example manifest_2025-10-31.json:

{
  "manifest_id": "2025-10-31T17:02:00Z",
  "source": "MRI",
  "entries": [
    {
      "uid": "img_000134",
      "file_path": "processed/tensors/img_000134.cten",
      "checksum_crc64": "b47af09de3c4a9a2",
      "dimensions": [512, 512, 3],
      "preprocessing": {
        "windowing": [0, 4096],
        "normalized": true,
        "seed": 42
      }
    }
  ],
  "summary": {
    "total_files": 135,
    "missing": 0,
    "avg_resolution": [512, 512]
  }
}


All manifests are automatically verified by core/src/meta/chronicle.rs.

VI. Deterministic Preprocessing Rules

Seed Control: All augmentations (noise, crop, rotation) use explicit seed values.

Precision: Use f32 for image tensors; conversions to u16/u8 quantize deterministically.

Compression: Allowed formats — PNG (16-bit), NPY (float32), custom .cten/.sten.

Reversibility:

$$\Delta_{reconstruct} < 1e^{-3}$$ between raw and reconstructed tensor.

Provenance Chain: Every derived tensor must reference its origin via manifest UID.

VII. Validation & Quality Control

Automated checks (executed nightly):

Checksum parity across OS

Pixel intensity histogram drift

HSL chromatic coherence score (core/diagnostics)

Manifest schema compliance

Results are written to data/logs/validation_<date>.json with metrics:

Metric	Pass Criteria
checksum_match	True
$$\Delta_{mean\_intensity} \le 1\%$$
chromatic_coherence	$$\ge 0.95$$
manifest_valid	True
VIII. Ethical Safeguards

De-identification: No raw personally identifiable data stored.

Reconstruction limits: Reversible anonymization (hash-based) only.

Access policy: data/raw/ read-only for training agents; writable only by authorized ingest scripts.

Audit trail: Every read/write logged by meta/chronicle.rs.

IX. Inter-Module Integration
Consumer	Reads	Writes	Notes
trainer	processed/	samples/	Uses deterministic batch loader
core/tensor	processed/tensors/	processed/tensors/	Round-trip tests
core/diagnostics	logs/, manifests/	logs/	Produces quality reports
meta/chronicle	manifests/, logs/	results/	Embeds checksums in chronicle headers
X. Versioning & Lifecycle
Phase	Retention	Notes
Raw	Permanent (immutable)	never deleted
Processed	24 months	regenerated when preprocessing updated
Samples	Permanent	used for demos
Logs	6 months	archived in experiments/archive/
XI. Compliance

Spec Version: 1.0

Determinism Level: Full (bit-exact manifests)

Checksum Standard: CRC-64/ISO

Audit Policy: Automated nightly via Diagnostics

Maintainer: Data Systems Agent (Codex)

Last Revision: {{auto-date}}