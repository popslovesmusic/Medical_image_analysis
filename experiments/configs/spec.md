# Module Specification

**Path:** experiments/configs
**Generated by:** Codex cleanup task
**Date:** 2025-10-31

Specification: Experiment Configuration Layer

Module Path: experiments/configs/
Parent Specs:

experiments/spec.md (framework root)

core/meta/spec.md (metadata and hashing)

trainer/spec.md (training and evaluation)

core/diagnostics/spec.md (metrics integration)

I. Mission

The Configuration Layer governs how experiment parameters are defined, stored, and executed so that all training runs are traceable, repeatable, and comparable.

It ensures that every parameter influencing a result is:

Explicitly defined in version-controlled YAML or JSON.

Has a deterministic ordering and schema.

Can be hashed and verified as part of an immutable manifest.

This makes it impossible to alter or rerun an experiment without detection.

II. Directory Layout
experiments/configs/
├─ templates/        # Reference configuration templates
├─ active/           # Current configurations queued for execution
├─ validated/        # Checked and approved configurations (frozen)
├─ archived/         # Obsolete or deprecated configurations
├─ schemas/          # JSON Schema validators
├─ defaults.yaml     # Global fallback parameters
└─ registry.json     # Index of all known configuration hashes

III. Configuration Philosophy
Principle	Description
Declarative, not procedural	All parameters are declared statically (no embedded scripts).
Hashable and comparable	Deterministic YAML ordering and float rounding.
Self-contained	No external dependencies or imports.
Auditable	Every config is cryptographically tracked in registry.json.
Isomorphic with runtime state	Training and diagnostics must reproduce identical state given the same file.
IV. Configuration Schema

Every configuration follows the same canonical YAML structure.

experiment_id: "exp_2025_11_01_color_bridge_finetune"
description: "Fine-tuning Chromatic Bridge model with Phase 7 dataset augmentation."
version: 1.1
seed: 42

modules:
  - trainer
  - core.diagnostics
  - core.bridge
  - core.tensor

parameters:
  learning_rate: 0.001
  batch_size: 16
  epochs: 30
  optimizer: "adamw"
  scheduler: "cosine_annealing"
  weight_decay: 0.0001

dataset:
  name: "MRI_T1_Contrast_Aug"
  split_ratio: [0.8, 0.1, 0.1]
  augmentation:
    flip: true
    rotation_deg: 10
    noise_std: 0.01

outputs:
  metrics: ["accuracy", "f1_score", "energy_drift_db"]
  visualizations: true
  checkpoint_interval: 5

notes:
  - "Test sensitivity to low-light regions."
  - "Track coherence variance over epochs."

V. Deterministic Serialization

Before execution, configurations are serialized and frozen via the following process (implemented in core/meta/chronicle.rs):

Alphabetically sort all keys (including nested dictionaries).

Normalize floats to 6 decimal places.

Replace tabs with spaces.

Enforce UTF-8 LF line endings.

Compute SHA-256 checksum.

Register hash → experiment ID mapping in registry.json.

This guarantees identical configuration fingerprints across environments.

VI. JSON Schema Validator

All YAML configurations must pass validation against a schema in experiments/configs/schemas/experiment_schema.json.

Example partial schema:

{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Experiment Configuration Schema",
  "type": "object",
  "required": ["experiment_id", "seed", "parameters", "modules"],
  "properties": {
    "experiment_id": { "type": "string" },
    "seed": { "type": "integer", "minimum": 0 },
    "modules": {
      "type": "array",
      "items": { "type": "string" }
    },
    "parameters": { "type": "object" },
    "dataset": { "type": "object" },
    "outputs": { "type": "object" }
  },
  "additionalProperties": false
}


Validation is executed automatically before training starts:

scripts/validate_config_schema.py

VII. Versioning and Lifecycle
State	Folder	Description
Draft	templates/	Editable templates; not hash-locked.
Active	active/	Submitted for current training runs.
Validated	validated/	Passed all schema + hash checks.
Archived	archived/	No longer used; immutable.

Version changes trigger an update in both:

config.version field

registry.json master hash record

VIII. Hash Registry (registry.json)

Example entry:

{
  "exp_2025_11_01_color_bridge_finetune": {
    "version": "1.1",
    "hash": "1a7b2c45e3f61b09ab0fd5f6e5bb9b5a...",
    "timestamp": "2025-11-01T20:42:00Z",
    "status": "validated"
  }
}


Hashes from the registry are compared automatically by scripts/verify_config_hash.py before job submission.

IX. Linking Configs to Manifests

Each experiment manifest (in /experiments/manifests/) contains:

A reference to the corresponding configuration hash.

A pointer to its path (configs/validated/exp_id.yaml).

A duplicate of the parameter subset for redundancy.

This ensures bidirectional verification: the config references the manifest, and the manifest reasserts the config’s integrity.

X. Cross-Phase Integration
Module	Purpose
trainer/	Consumes config parameters for optimization.
core/diagnostics/	Reads metric tracking and thresholds.
core/bridge/	Defines hue-frequency mapping rules.
core/meta/chronicle/	Logs configuration hashes and timestamps.
experiments/archive/	Stores frozen configs for completed runs.
XI. Automation Tools
Script	Function
generate_config_template.py	Create new YAML template with defaults
validate_config_schema.py	Validate all YAML files via JSON schema
register_config_hash.py	Compute and record SHA-256 hash
compare_configs.py	Show field-by-field diff between two configs
freeze_active_configs.py	Move configs to validated state post-check
restore_config_from_archive.py	Retrieve configuration by hash

All scripts must run deterministically and emit identical logs on Windows and Linux.

XII. Compliance Rules
Rule	Constraint
Global Seed	42 (default)
Float Precision	6 decimal places
File Encoding	UTF-8
Line Endings	LF
Hash Algorithm	SHA-256
Schema Version	1.0
Change Detection	SHA mismatch aborts job
Backward Compatibility	Config schema evolves via version: field
XIII. Compliance Summary
Field	Specification
Spec Version	1.0
Determinism Level	Bit-Exact
Schema Authority	JSON Schema Draft 07
Hash Algorithm	SHA-256
Audit Authority	Codex Config Agent
Revision	{{auto-date}}
Status	✅ Verified Config Integrity