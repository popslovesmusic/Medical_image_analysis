# Module Specification

**Path:** experiments/archive
**Generated by:** Codex cleanup task
**Date:** 2025-10-31

Specification: Experimental Archive Subsystem

Module Path: experiments/archive/
Parent Specs:

experiments/spec.md (framework root)

experiments/results/spec.md (result layer)

core/meta/chronicle/spec.md (provenance tracker)

docs/spec.md (report linkage and publication)

I. Mission

The Archive Subsystem ensures that every experimental result can be reproduced exactly, verified cryptographically, and restored deterministically at any point in the project’s lifecycle.

It acts as the immutable ledger of truth for the experimental domain, storing every model weight, result artifact, configuration file, and manifest required to replay or audit past runs.

II. Directory Layout
experiments/archive/
├─ bundles/           # Compressed experiment packages (.zip/.tar.gz)
├─ manifests/         # Cryptographic ledger of archived runs
├─ restoration/       # Scripts & tools for rehydrating archived experiments
├─ snapshots/         # Intermediate staging areas for pre-archive validation
├─ verification/      # Log and report files for archive integrity checks
└─ keys/              # Public signing keys for archive verification (optional)

III. Archive Lifecycle
Phase	Description	Output
1. Freeze	Finalize experiment directory post-validation	snapshots/
2. Package	Compress deterministic bundle (no timestamps)	bundles/*.zip
3. Hash	Compute SHA-256 + optional signature	manifests/*.json
4. Verify	Recompute checksum, compare, mark immutable	verification/logs/*.txt
5. Store	Move to cold storage or replication node	External (offline)
6. Restore	Decompress and reconstruct working copy	restoration/
IV. Bundle Composition

Each archive bundle is a fully self-contained unit of record with the following internal layout:

bundle_<experiment_id>.zip
│
├─ config/                      # Original YAML configuration
│   └─ exp_<id>.yaml
│
├─ results/                     # All verified output files
│   ├─ metrics/
│   ├─ plots/
│   ├─ summaries/
│   └─ visualizations/
│
├─ manifests/                   # Result & experiment manifests
│   └─ manifest_<id>.json
│
├─ model/                       # Saved model weights (if applicable)
│   └─ model_<id>.pt
│
└─ logs/                        # Diagnostics and runtime traces
    ├─ console.log
    ├─ diagnostics.json
    └─ integrity_report.txt

V. Deterministic Packaging Rules
Rule	Description
No timestamps	File system metadata stripped before compression
Fixed compression level	Gzip/ZIP level = 6 for all archives
Sorted inclusion order	Files added alphabetically for stable SHA
Path normalization	Forward slashes / only, UTF-8 encoded
Hash-before-store	Compute SHA before moving to bundles folder
No symbolic links	All files dereferenced to prevent ambiguity

Deterministic packaging is handled by scripts/archive_experiment.py.

VI. Archive Manifest Schema

Each archive has a companion JSON manifest (stored in /manifests/):

{
  "archive_id": "exp_2025_10_31_color_bridge_validation",
  "bundle_path": "experiments/archive/bundles/exp_2025_10_31.zip",
  "sha256": "7e3af1bb5f17c9b0d3c1a9a54a98a741b948d07d8a2f4f3a09327e69f2e384a2",
  "timestamp": "2025-10-31T23:40:00Z",
  "source_commit": "8f2b3d1",
  "seed": 42,
  "included_files": [
    "config/exp_2025_10_31.yaml",
    "results/metrics/exp_2025_10_31.json",
    "results/plots/loss_curve.svg",
    "results/summaries/exp_2025_10_31_summary.md"
  ],
  "verified": true,
  "signature": "optional_ed25519_signature_base64"
}


Verification is done by:

scripts/verify_archive_integrity.py

core/meta/chronicle.rs (for cross-phase validation)

VII. Verification Pipeline
A. Local Verification

Compute SHA-256 for each file inside the bundle.

Compare to values in the manifest.

Generate verification report in verification/logs/.

B. Chain Verification (Cross-Module)

Performed by core/meta/chronicle.rs:

Confirms that every experiment manifest referenced in the global chronicle exists in archive/manifests/.

Ensures bundle hashes match previously recorded SHA values.

Validates that results and docs cross-link correctly.

Example Log Output
[VERIFICATION]
Archive: exp_2025_10_31.zip
Manifest: OK
Results Hash: OK
Config Match: OK
Documentation Link: OK
Overall Status: ✅ VERIFIED

VIII. Restoration Workflow
Step	Action	Result
1. Select	Choose manifest or bundle by ID	exp_####
2. Verify	Confirm SHA and manifest validity	verification/
3. Extract	Decompress to restoration/<id>/	Working copy ready
4. Register	Log restoration in chronicle	Audit trail complete

Optional: --replay flag re-runs the experiment with original parameters for reproducibility testing.

IX. Automation Scripts
Script	Function
archive_experiment.py	Bundle and hash validated experiments
verify_archive_integrity.py	Recompute and cross-check hashes
restore_experiment.py	Safely extract bundle
list_archives.py	Show all registered bundles
purge_temp_archives.py	Clean incomplete snapshots
chronicle_sync.py	Sync manifests with meta log
X. Signing and Trust (Optional Extension)

For projects under regulatory or peer-review constraints, archives can be signed using Ed25519.

File	Description
keys/public_key.pem	Verification key (distributed)
keys/private_key.pem	Signing key (restricted)
*.sig	Detached signature of archive manifest

Signature verification handled by:

scripts/verify_archive_signature.py --manifest manifest_<id>.json

XI. Long-Term Storage

Archives may be offloaded to:

S3 / Azure cold-tier buckets

Institutional repositories

Encrypted external drives

All storage targets maintain:

Immutable write-once policy

Replicated hashes

Restoration scripts mirrored with bundle

XII. Integration and Provenance Map
Source	Destination	Purpose
experiments/results/	archive/bundles/	Consolidate verified outputs
experiments/manifests/	archive/manifests/	Record archive SHA
core/meta/chronicle.rs	archive/verification/	Track global history
docs/reports/	archive/bundles/	Include experiment summaries
XIII. Compliance Rules
Rule	Guarantee
Fixed file order	Deterministic SHA
No file timestamps	Reproducible bundles
UTF-8 encoding	Cross-platform consistency
No binary drift	Bit-for-bit reproducibility
Signed manifests	Optional cryptographic assurance
Hash verification before publish	Integrity checkpoint
XIV. Compliance Summary
Field	Specification
Spec Version	1.0
Determinism Level	Bit-Exact
Hash Algorithm	SHA-256
Signature (optional)	Ed25519
Seed Policy	Global 42
Audit Authority	Codex Archival Agent
Revision	{{auto-date}}
Status	✅ Verified Archive Integrity